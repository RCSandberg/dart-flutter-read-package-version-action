name: Dart & Flutter - Read package version
description: 'Reads the package semantic version from the pubspec.yaml'
author: RCSandberg
branding:
  icon: 'type'
  color: 'green'
inputs:
  path:
    description: "Path to pubspec.yaml. Defaults to: ./pubspec.yaml"
    required: false
    default: "./pubspec.yaml"
outputs:
  package-semantic-version:
    description: "Package semantic version"
    value: ${{ steps.semantic-version.outputs.package-semantic-version }}
  package-version:
    description: "Package version"
    value: ${{ steps.semantic-version.outputs.package-version }}
  package-major:
    description: "Package major version"
    value: ${{ steps.semantic-version.outputs.package-major }}
  package-minor:
    description: "Package minor version"
    value: ${{ steps.semantic-version.outputs.package-minor }}
  package-patch:
    description: "Package patch version"
    value: ${{ steps.semantic-version.outputs.package-patch }}
  package-prerelease:
    description: "Package pre-release version"
    value: ${{ steps.semantic-version.outputs.package-prerelease }}
  package-buildmetadata:
    description: "Package build metadata"
    value: ${{ steps.semantic-version.outputs.package-buildmetadata }}
runs:
  using: "composite"
  steps:
    - uses: actions/setup-python@v5
      with:
        python-version: '3.10' 
    - name: Extract semantic version
      id: semantic-version
      shell: bash
      run: |
        SEMVER=`cat ${{inputs.path}} | grep -m 1 -o 'version:[^:]*' | cut -f2 -d":" | xargs`
        echo "package-semantic-version=$SEMVER" >> $GITHUB_OUTPUT
        python ./read_semantic_version.py $SEMVER
